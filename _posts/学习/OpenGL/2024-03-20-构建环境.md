---
layout: post
title:  "2.构建环境"
date:   2024-03-20
categories: OpenGL
---

## 创建窗口
在我们画出出色的效果之前，首先要做的就是创建一个OpenGL上下文和一个用于显示的窗口。然而，这些操作在每个系统上都是不一样的，OpenGL有意将这些操作抽象出去。这意味着我们不得不自己处理创建窗口，定义OpenGL上下文以及处理用户输入。
幸运的是，有一些库已经提供了我们所需的功能，其中一部分是特别针对OpenGL的。这些库节省了我们书写操作系统相关代码的时间，提供给我们一个窗口和一个OpenGL上下文用来渲染。最流行的几个库有GLUT，SDL，SFML和GLFW。在教程里我们将使用GLFW。

>GLFW是一个专门针对OpenGL的C语言库，它提供了一些渲染物体所需的最低限度的接口。它允许用户创建OpenGL上下文、定义窗口参数以及处理用户输入，对我们来说这就够了。

1：下载[GLFW源代码包](https://www.glfw.org/download.html)。简单起见我们直接下载已经编译好的windows32包。这个代码包包含很多内容，但最终我们只需要编译生成的库和include文件夹。这里我们就使用静态库只保留最新的glfw3.lib就好。
2：新建空项目。使用显示所有文件来观察项目，然后创建src文件夹，创建Application入口文件，将glfw官网文档的示例代码复制其中，由于项目使用32位，需要把debug改成x86.
![设置](../../../assets/OpenGL/2_1.png)
3：依赖项配置
在项目目录下创建依赖项文件夹
![image.png](https://note.youdao.com/yws/res/10388/WEBRESOURCEbde8347cf632691f341b2f20aa0bd9e4)
创建GLFW子文件夹，并将下载的include放入其中
![image.png](https://note.youdao.com/yws/res/10392/WEBRESOURCEd3a4be45b4f52bcb986c9ef31cb4574e)
将适合版本的静态库保留，其他的删除掉
![image.png](https://note.youdao.com/yws/res/10396/WEBRESOURCE43f9475962ee28a995705d4cb0193c77)
进入项目配置页，依次配置include和lib，主要是添加上面加入的glfw路径
![image.png](https://note.youdao.com/yws/res/10399/WEBRESOURCE82e359e3028ec39a0ff8c232afb59e42)
最后配置链接，删除所有的然后输入图中的lib
![image.png](https://note.youdao.com/yws/res/10403/WEBRESOURCE38aaf6d0da3c9dff0b8165c776b16d37)
此时生成项目应该会报很多错误，依次在微软文档中搜索这些报错关键词，找到所需的链接，依次补充即可，最后
![image.png](https://note.youdao.com/yws/res/10409/WEBRESOURCEc838f3fbb71aae3455ca22fb30d12855)
4：本地调试
此时本地调试，已经出现黑框
![image.png](https://note.youdao.com/yws/res/10412/WEBRESOURCEbf60fc762a8f64371fd9ee46d130690e)

## 调用函数
我们是可以创建一个用于绘制的窗口了，但是如果想上手绘制，我们还需要调用显卡驱动里的函数，如何调用？我们需要实际进入这些驱动程序中去提取并调用函数，说是提取函数，其实是获取函数声明然后链接到函数，所以我们需要通过检索DLL找到库中函数的指针，OpenGL更新至今已经有很多函数了，虽然理论上来说我们是可以手动执行这个操作，但是每用到一个就要执行一次未免太繁琐。所以我们不妨用现有的库来帮助我们完成这个繁琐的任务，最常用的有glad和glew。glad很好它包含的函数非常全面，但是我们用不到那么多，基本上glew就完全足够我们学习用了。

1：还是一样，在[glew官网](glew.sourceforge.net)下载32位包
将其复制到依赖项文件夹下并重命名为GLEW
![image.png](https://note.youdao.com/yws/res/10428/WEBRESOURCE7c31a17dd1bf9a19763efbe8212602d7)
进入GLEW，里面有使用文档
![image.png](https://note.youdao.com/yws/res/10433/WEBRESOURCE93d03d649a25df6bb82994c250080dc8)
2：配置依赖项
和上面glfw一样，加入include、lib
![image.png](https://note.youdao.com/yws/res/10441/WEBRESOURCE1e367ea2a599a47cd7810e4c4327e6f8)
链接静态库填写时需要注意，哪一个是静态库？根据大小或者名称中的s可以得知。
![image.png](https://note.youdao.com/yws/res/10443/WEBRESOURCE26aa655be94586fbde232c13ae907bcb)
![image.png](https://note.youdao.com/yws/res/10447/WEBRESOURCEf7fdfcb009f8585b0e9b31690dcc0794)

#### 使用glew
此时我们就可以在代码中使用glew了，glew在使用过程中有几点需要注意：第一是，在使用前需要使用glewInit()函数初始化
![image.png](https://note.youdao.com/yws/res/10452/WEBRESOURCEb2f6939e44963640bec370d6d8e1eaed)
此时生成项目，你会得到一个报错，这是因为glew必须声明在glfw之前
![image.png](https://note.youdao.com/yws/res/10455/WEBRESOURCEb2395fe0bcb95e575147bd51ba9c4fc5)
改好后生成，还会报错，这是因为我们需要预处理定义为静态glew
![image.png](https://note.youdao.com/yws/res/10461/WEBRESOURCEed376a8d7865378314a5c2ab06342381)
但此时运行，还是有错误的，因为glewinit必须在有效的OpenGL上下文中，所以还需要移动初始化的位置。
![image.png](https://note.youdao.com/yws/res/10466/WEBRESOURCEa54a3e412c8b0cb047d50b6565ba82c0)


```C++
#include<GL/glew.h>
#include<GLFW/glfw3.h>
#include<iostream>

int main()
{
	GLFWwindow* window;

	/* Initialize the library */
	if (!glfwInit()) return -1;

	/* Create a windowed mode window and its OpenGL context */
	window = glfwCreateWindow(640, 480, "Hello World", NULL, NULL);
	if (!window)
	{
		
		glfwTerminate();
		return -1;
	}

	/* Make the window's context current */
	glfwMakeContextCurrent(window);

	if (glewInit() != GLEW_OK) std::cout << "Error" << std::endl;

	/* Loop until the user closes the window */
	while (!glfwWindowShouldClose(window))
	{
		/* Render here */
		glClear(GL_COLOR_BUFFER_BIT);

		/* Swap front and back buffers */
		glfwSwapBuffers(window);

		/* Poll for and process events */
		glfwPollEvents();
	}

	glfwTerminate();
	return 0;
}
```






















