关键词：远距离灯光，远点光，小灯远处也能看清楚





# NDC 空间缩放

NDC 空间缩放，控制远近距离时灯在屏幕上的大小

float scale = ClipSpaceScaleInvProportional(distance, NDC_Scale_Near_Distance, NDC_Scale_At_Far, NDC_Scale_At_Near);

NDC_Scale_At_Far 设置为 0.0125，属于比较“夸张”的值，说明作者是故意让远处灯在屏幕上别太小。

# 距离衰减

距离衰减采用 指数衰减，但衰减系数非常大

```Cpp

[vk::constant_id(17)](# "Reference vk::constant_id(17) \|\|\| __GENERATING_DETAILS__")
float Light_Intensity_Attenuation_Factor = 1000000.0f;

float intensityFactor = Light_Intensity_Attenuation_Factor;
float AlphaScale = angleGain * exp(-distance / intensityFactor);

```

衰减形式 ：exp(-distance / factor)  factor = 1000000 非常大 → 几公里内几乎不怎么掉。  
比如 distance = 5000 ： - exp(-5000/1000000) ≈ 0.995，也就是只衰减了 0.5%。  

# 光强增益

```Cpp
[vk::constant_id(5)](# "Reference vk::constant_id(5) \|\|\| __GENERATING_DETAILS__")
float Light_Intensity = 10.0f;

[vk::constant_id(6)](# "Reference vk::constant_id(6) \|\|\| __GENERATING_DETAILS__")
float Light_Intensity_Gain = 50.0f;   // 虽然当前代码没直接用，但明显预留了增益思路

float ColorScale = todGain * Light_Intensity * angleGain * (Light_Intensity_Percentage / 100.0f) * fog_intensity_Enhance;

```

Light_Intensity、Light_Intensity_Percentage、Fog_Light_Enhance 共同作用，让灯的颜色有很大空间被放大。
如果你把 Light_Intensity 调高、Light_Intensity_Percentage 设成 >100%，远处依然可以很亮。
综上：从设计上，它就是为“远处灯点保持明显亮度”服务的 billboard shader。

# 想要“远处也很亮”时，要重点调哪些参数？

你可以理解为：远处亮不亮 = 屏幕上够不够大 × 衰减得快不快 × 基础强度够不够。

## 让远处灯在屏幕上别太小（尺寸）

NDC_Scale_At_Far（远处 NDC 缩放）

NDC_Scale_At_Near（近处 NDC 缩放）

建议：

远处要明显：
保持或略提高 NDC_Scale_At_Far，比如 0.0125 → 0.015 ~ 0.02
如果近处太大，可以适当减小 NDC_Scale_At_Near，避免近处灯“糊脸”。
另外：

BaseMap_UV_Scale 控制灯纹理在灯片上的占比，想让光斑范围更大，可以适当 调大，比如 0.3 → 0.5。

## 让远处亮度不掉得太快（距离衰减）

Light_Intensity_Attenuation_Factor 越大，衰减越慢。
默认就是 1000000，已经非常“远处也能看见”的级别了。
如果你觉得远处还是暗：
可以拉到 1500000 ~ 2000000 再试。
注意：

另外的 Light_Interval 等只是为了做“隔几个灯稍微暗一点”的效果，你如果只是要“所有远处灯都亮”，可以先关：

## 提升整体亮度（基础强度）

```Cpp
[vk::constant_id(5)](# "Reference vk::constant_id(5) \|\|\| __GENERATING_DETAILS__")
float Light_Intensity = 10.0f;

[vk::constant_id(9)](# "Reference vk::constant_id(9) \|\|\| __GENERATING_DETAILS__")
float Light_Intensity_Percentage = 100.0f;

[vk::constant_id(32)](# "Reference vk::constant_id(32) \|\|\| __GENERATING_DETAILS__")
float Fog_Light_Enhance = 4;

float fog_intensity_Enhance = lerp(Fog_Light_Enhance, 1, saturate(fogScale));
float ColorScale = todGain * Light_Intensity * angleGain 
                 * (Light_Intensity_Percentage / 100.0f) 
                 * fog_intensity_Enhance;
output.container.a = ColorScale;

```
建议：

想整体更亮：
Light_Intensity：从 10 提到 15~30 试试
Light_Intensity_Percentage：从 100 提到 150~200 试试
如果是“雾里的远处灯要更突出”：
Fog_Light_Enhance：可以从 4 提到 6~8，看效果


如果你同时：
很大 Light_Intensity
很大 Light_Intensity_Attenuation_Factor
又把曝光（ManualExposure）调得很低
灯可能在画面里过曝成一大片白，甚至影响周围视觉对比。
处理方式：

先确定曝光链路（整个场景的 HDR & 曝光），再往上加灯强度，不要一上来就把灯开很猛。