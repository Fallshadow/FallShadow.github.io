- 开启 PCG 插件 和 Procedural Vegetation Editor 插件
- 项目设置里开启 Nanite Foliage 体素化
- 重启
- 找到 Procedural Vegetation Editor 插件里的场景 Asset_Zoo
- Wind_Example_PCG
- 调节 Scale 就是调节程序化生成的盒子的大小
- PCG 组件中的 Parameters 参数覆盖中指定程序化生成的树木
- BP_GlobalFoliageActor_UE5 里的 Wind 组件调节风力 Season 和 Health 可以调节季节和生命力效果

新的程序化植被编辑器采用节点系统，能将不同网格的实例转为骨骼网格，通过骨骼结构实现动画，这会为树木创建大量骨骼，从主干一直到末梢细枝，通过动画驱动这一骨骼层级，模拟出风吹的效果。

过去风的动态是通过材质来实现的，具体方法是使用世界位置偏移和顶点颜色，控制树干、树枝小枝和叶片，利用顶点颜色空间向不同方向偏移，因此根据树木每一部分的枢轴位置，从每段主干的根部开始，屏蔽顶点颜色以及树枝或小枝，使上方剩余部分能够独立动画且连接到分支，确保动画正常，避免根部被遮罩时，树枝部分悬空。

体素化技术：比如巫师4团队在展现北欧枫树岭大场景画面时，遇到了 alpha 测试带来的着色问题，alpha 测试通过简单的方式渲染树木上的植被，即采用二维单面平面来来实现，这一单面平面会利用黑色区域进行遮罩，在蒙版或不透明度贴图中只显示平面内的植被，边缘的黑色区域则会被隐藏，渲染引擎还需逐个处理每个平面的透明效果，这会引发问题，例如屏幕空间分层，ZZ缓冲之类，也就是网格的深度信息，问题在于平面不具备深度缓冲或深度信息，作为二维平面，会导致遮挡错误，阴影无法被正确计算，因此会出现阴影异常。在遮罩材质上，平面背面孔不接收光线。

现在可以在静态网格中启用体素化功能，启用 nanite 后不再使用二维平面，转而使用完整的几何模型。体速化采用 4×4×4 的体素方块，而非保留精细细节。也就是说距离越远，树木就会变成一组立方体。nanite 会将三角面逐步转化为更大的面，当你远离物体时，其用 nanite 后效果还不如材质，还存在问题。我们还无法自主创建完整的树木模型，只能调整细枝树叶等局部部件，无法修改整棵树的整体模板。

此时使用 cmd 命令： r.Nanite.ViewMeshLODBias.Offset 4 (默认值是 0，可以为负数增添细节，或者正数减少细节)

# PVE_European_QuakingAspen_01

学习下这个 PVE。它程序化生成了一组树木。

## Output

可以设置 Wing Setting。在这里依次设置 树干 树枝 树叶。

## 创建自己的树

- slope : 坡度。调节倾斜角度等。
- gravity : 重力。调节枝条树干的重力方向和强度。
- carve : 剪切。对树进行不同方向的裁剪来制作差异化树木。
- scale : 缩放。
- remove branches : 移除树枝。

构建！

- mesh build : 
  - Plant Profile Setting : 调节树干粗细。
  - Displacement : 展示贴图。
  - mesh setting : 可以设置分段数、曲率变化不高的情况下的顶点剔除，让其更精细或者更粗。在线框模式下预览更好。
- Bone Reduction : 骨骼简化。
- Foliage Palette : 植被调色盘。
- Foliage Distributor : 植被分配。分配效果。
- Output : 输出结果。选择导出的路径和设置。

现在 PFE 可以解决问题

# PCG 系统

Wind_Example_PCG 对应资源

## Surface_Sampler

按下 D 键调试查看。可以调节每平方米的点的个数，调节点的密集程度。

## Transform_Points

变换点的位置信息

- 随机轴旋转
- 绝对旋转：一定要开启，如果不开启，树木会随着地形进行旋转，这不是我们想要的效果，因为现实生活中，树木一直会是笔直向上生长的。

## Density_Filter

密度过滤器，值的范围在零到一之间，它代表的是从白色到黑色的灰度值。你可以对这个资源设置一个最小值和一个最大值，这个资源只会出现在这个灰度值的立方体里。这个功能很有用尤其是你有多个资源要在同一片场景中生成的时候，比如你有树，石头，草，你就可以对数设置成零到0.2，石头设置成0.3到0.5，草设置成0.6到0.8，这样它们就会随机分布并且不会碰撞在一起。

## Self Pruning

自修剪功能，如果树和树之间有重叠，开启这个功能就可以自动修剪重叠的部分。可以设置修剪方式达到不同的效果。