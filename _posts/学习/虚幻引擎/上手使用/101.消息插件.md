# GameplayMessageRouter

GameplayMessageRouter 是一个官方推荐的轻量级事件通信系统，专门用来在项目中解耦模块间通信，取代了许多场合下的 Event Dispatchers 或 GameplayTags event system。它是游戏框架插件 “GameplayMessageRuntime” 的核心组件。

GameplayMessageRouter 属于一个叫 Gameplay Message System 的机制，提供一种 基于通道（Channel）+ 数据结构（Payload） 的发布/订阅模型。

其核心思想类似：

任意对象都可以向指定通道发布一条消息，而其它订阅该通道的对象就能接收到这条消息。

通道（Channel）通常使用 GameplayTag 来标识。

# 主要组成部分

| 组件                             | 作用                                                 |
| -------------------------------- | ---------------------------------------------------- |
| `UGameplayMessageSubsystem`      | 管理全局的消息注册与广播。你通过它来发送或监听消息。 |
| `FGameplayMessageListenerHandle` | 监听器的引用，用于取消订阅。                         |
| `FGameplayMessageListenerData`   | 订阅信息（通道、过滤条件等）。                       |
| `FGameplayMessagePayload`        | 自定义数据结构，随消息发送。                         |

# 导入



可以从 lyra 游戏项目文件的插件中直接复制 GameplayMessageRouter 文件夹。

依赖项

```Cpp

PublicDependencyModuleNames.AddRange(new string[] { 
    ...
    "GameplayMessageRuntime",
});

```

包含路径

```Cpp

#include "GameFramework/GameplayMessageSubsystem.h"

```

# 定义消息数据结构

定义一个结构体作为消息内容

```Cpp

// MyGameMessageData.h
#pragma once
#include "GameplayMessageTypes.h"
#include "MyGameMessageData.generated.h"

USTRUCT(BlueprintType)
struct FMyGameMessageData
{
    GENERATED_BODY()

    UPROPERTY(BlueprintReadWrite)
    AActor* Instigator = nullptr;

    UPROPERTY(BlueprintReadWrite)
    int32 ScoreChange = 0;
};

```