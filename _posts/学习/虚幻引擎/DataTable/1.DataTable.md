- [简介](#简介)
  - [是什么？](#是什么)
  - [做什么？](#做什么)
  - [导出](#导出)
  - [导入](#导入)
- [如何使用](#如何使用)
  - [建立结构体](#建立结构体)
  - [常用功能](#常用功能)
  - [根据多个指标筛选](#根据多个指标筛选)
- [思维路线图](#思维路线图)
  - [知识思路](#知识思路)
  - [使用思路](#使用思路)
- [引申知识](#引申知识)


# 简介

## 是什么？

本质：DataTable 是 UE 中的结构体表格数据容器，一行对应一条记录，一列对应一个结构体字段。

每个 DataTable 必须绑定一个 UScriptStruct

## 做什么？

常见用途：

配表：怪物属性、武器表、关卡配置、任务表、数值表

## 导出

可以直接右键导出为 json 或者 csv

## 导入

直接把 json 拉进来

# 如何使用

## 建立结构体

```Cpp
USTRUCT(BlueprintType)
struct FFFS_FoliageLightTypeIntensity : public FTableRowBase {
    GENERATED_BODY()

public:
    UPROPERTY(EditAnywhere, BlueprintReadWrite)
    int LightType;

    UPROPERTY(EditAnywhere, BlueprintReadWrite)
    bool IsFar;

    UPROPERTY(EditAnywhere, BlueprintReadWrite)
    int IntensityCtrlLevel;

    UPROPERTY(EditAnywhere, BlueprintReadWrite)
    float Intensity;
};
```

## 常用功能

```Cpp
// Called when the game starts or when spawned
void AS_DTReader::BeginPlay()
{
	Super::BeginPlay();

	
	// 1: 直接

	//FName _rowname = FName(TEXT("A"));
	//FString ContextString = TEXT("TEXT");
	//if (MyFruitTable) {
	//	FFruit* _data = MyFruitTable->FindRow<FFruit>(_rowname, ContextString, false);
	//	if (_data) {
	//		UE_LOG(LogTemp, Warning, TEXT("Name:%s, Price:%f, Type:%d, Weight:%f, IsFresh:%d"), *_data->Name, _data->Price, _data->Type, _data->Weight, _data->IsFresh);
	//	}
	//	else {
	//		UE_LOG(LogTemp, Warning, TEXT("Not Found DT Row"));
	//	}
	//}
	//else {
	//	UE_LOG(LogTemp, Warning, TEXT("Not Found DT"));
	//}

	// 2: 资源路径
	// 直接对资源右键复制引用就可以获取 TEXT 中的字符串

	//MyFruitTable = Cast<UDataTable>(StaticLoadObject(UDataTable::StaticClass(), nullptr, TEXT("/Script/Engine.DataTable'/Game/Levels/004DataTable/004DT_Fruit.004DT_Fruit'")));
	//FName _rownameB = FName(TEXT("B"));
	//FString ContextString = TEXT("TEXT");
	//if (MyFruitTable) {
	//	FFruit* _data = MyFruitTable->FindRow<FFruit>(_rownameB, ContextString, false);
	//	if (_data) {
	//		UE_LOG(LogTemp, Warning, TEXT("Name:%s, Price:%f, Type:%d, Weight:%f, IsFresh:%d"), *_data->Name, _data->Price, _data->Type, _data->Weight, _data->IsFresh);
	//	}
	//	else {
	//		UE_LOG(LogTemp, Warning, TEXT("Not Found DT Row"));
	//	}
	//}
	//else {
	//	UE_LOG(LogTemp, Warning, TEXT("Not Found DT"));
	//}

	// 3: GetRowNames 获取所有

	//if (MyFruitTable) {
	//	FString ContextString = TEXT("TEXT");
	//	TArray<FName> _rowNames;
	//	_rowNames = MyFruitTable->GetRowNames();
	//	for (auto _rowName : _rowNames) {
	//		FFruit* _data = MyFruitTable->FindRow<FFruit>(_rowName, ContextString, false);
	//		UE_LOG(LogTemp, Warning, TEXT("Name:%s, Price:%f, Type:%d, Weight:%f, IsFresh:%d"), *_data->Name, _data->Price, _data->Type, _data->Weight, _data->IsFresh);
	//	}
	//}
	//else {
	//	UE_LOG(LogTemp, Warning, TEXT("Not Found DT"));
	//}

	// 4: GetAllRows 获取所有

	//if (MyFruitTable) {
	//	FString ContextString = TEXT("TEXT");
	//	TArray<FFruit*> _rows;
	//	MyFruitTable->GetAllRows(ContextString, _rows);
	//	for (auto _row : _rows) {
	//		UE_LOG(LogTemp, Warning, TEXT("Name:%s, Price:%f, Type:%d, Weight:%f, IsFresh:%d"), *_row->Name, _row->Price, _row->Type, _row->Weight, _row->IsFresh);
	//	}
	//}
	//else {
	//	UE_LOG(LogTemp, Warning, TEXT("Not Found DT"));
	//}

	// 5: GetAllRows 获取所有

	//if (MyFruitTable) {

	//	auto _rowmap = MyFruitTable->GetRowMap();
	//	for (auto _row : _rowmap) {
	//		FFruit* _data = (FFruit*)_row.Value;
	//		UE_LOG(LogTemp, Warning, TEXT("Name:%s, Price:%f, Type:%d, Weight:%f, IsFresh:%d"), *_data->Name, _data->Price, _data->Type, _data->Weight, _data->IsFresh);
	//	}
	//}
	//else {
	//	UE_LOG(LogTemp, Warning, TEXT("Not Found DT"));
	//}

	// 6: AddRow 写入

	if (MyFruitTable) {
		FName rowName = FName(TEXT("SSR"));

		FFruit _addData;
		_addData.Name = FString(TEXT("Gold Peach"));
		_addData.Price = 99.9f;
		_addData.Weight = 9.99f;
		_addData.IsFresh = true;
		_addData.Type = EFruitType::Peach;

		MyFruitTable->AddRow(rowName, _addData);

		FString ContextString = TEXT("TEXT");
		TArray<FFruit*> _rows;
		MyFruitTable->GetAllRows(ContextString, _rows);
		for (auto _row : _rows) {
			UE_LOG(LogTemp, Warning, TEXT("Name:%s, Price:%f, Type:%d, Weight:%f, IsFresh:%d"), *_row->Name, _row->Price, _row->Type, _row->Weight, _row->IsFresh);
		}
	}
	else {
		UE_LOG(LogTemp, Warning, TEXT("Not Found DT"));
	}
}
```

## 根据多个指标筛选

```Cpp
FFFS_FoliageLightTypeIntensity* FindRowByTwoColumns_Manual(UDataTable* DataTable, int LightType, bool IsFar, int TargetLevel)
{
	if (!DataTable) return nullptr;

	TArray<FFFS_FoliageLightTypeIntensity*> Rows;
	FString ContextString = TEXT("TEXT");
	DataTable->GetAllRows<FFFS_FoliageLightTypeIntensity>(ContextString, Rows);

	for (FFFS_FoliageLightTypeIntensity* Row : Rows) {
		if (!Row) continue;

		if (Row->LightType == LightType && Row->IsFar == IsFar && Row->IntensityCtrlLevel == TargetLevel) {
			return Row; // 找到匹配行
		}
	}

	return nullptr; // 没找到
}
```

# 思维路线图

## 知识思路

- 本质？结构体
- 用途？配表

## 使用思路

- 新建结构体蓝图
- 新建数据表杂项 Miscellaneous -> DataTable
- 在蓝图里创建 DataTable 变量，进行相关操作

# 引申知识

CurveTable