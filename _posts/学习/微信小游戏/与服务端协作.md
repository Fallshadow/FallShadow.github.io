Postman 专用于API开发和测试的工具

消息包体结构

api_id
int
消息ID，用来标记消息，便于解析消息结构

data
object
消息内容，根据消息id会有不同的消息结构


Unity JsonUtility 解析消息



首先服务端需要先使用http网址进行微信code登陆，这里使用UnityWebRequest完成，但是注意在连接时，http需要在other setting设置里允许，因为他是不安全的。
![](../../../assets/WeiXinMiniGame/11.png)

```Cpp
private IEnumerator PostLoginHttpRequest() {
    WSWXLoginInfoRequest loginInfo = new WSWXLoginInfoRequest();
    loginInfo.username = "player_1";
    loginInfo.wx_code = 1231;

    string loginInfoString = JsonUtility.ToJson(loginInfo);
    // UnityWebRequest.kHttpVerbPOST 这里注意方式，是post还是get还是啥
    using(UnityWebRequest loginRequest = new UnityWebRequest(wxLoginAddress, UnityWebRequest.kHttpVerbPOST)) {
        UploadHandler uploader = new UploadHandlerRaw(Encoding.Default.GetBytes(loginInfoString));
        loginRequest.uploadHandler = uploader;
        loginRequest.uploadHandler.contentType = "application/json";  // 设置HTTP协议的请求头，默认的请求头HTTP服务器无法识别

        // 这里需要创建新的对象用于存储请求并响应后返回的消息体，否则报空引用的错误
        DownloadHandler downloadHandler = new DownloadHandlerBuffer();
        loginRequest.downloadHandler = downloadHandler;

        yield return loginRequest.SendWebRequest();

        if(loginRequest.result == UnityWebRequest.Result.ConnectionError || loginRequest.result == UnityWebRequest.Result.ProtocolError) {
            Debug.LogError(loginRequest.error);
        }
        else {
            //string reciveStr = System.Text.Encoding.UTF8.GetString(webRequest.downloadedBytes);
            Debug.Log("Form upload complete And receive data :" + loginRequest.downloadHandler.text);
            WSWXLoginInfoReceive loginInfoReceive = JsonUtility.FromJson<WSWXLoginInfoReceive>(loginRequest.downloadHandler.text);
            Debug.Log(loginInfoReceive);
            SendGameLogin(loginInfoReceive.token);
        }
    }

    //byte[] bodyRaw = Encoding.UTF8.GetBytes(loginInfoString);
    //loginRequest.uploadHandler = new UploadHandlerRaw(bodyRaw);
    //loginRequest.downloadHandler = new DownloadHandlerBuffer();
    //loginRequest.SetRequestHeader("Content-Type", "application/json");
}
```
WebSocket接入时，也要注意ws和wss的区别