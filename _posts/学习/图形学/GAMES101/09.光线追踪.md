# 阴影

之前我们提到局部着色，只考虑着色点，光源，摄像机。完全不考虑其他物体甚至这个物体本身对着色点的影响

不渲染阴影会感觉所有东西都在浮空，阴影会给人物体和物体接触的感觉

## shadow mapping

如果点不在阴影里，你又能看到这个点，那说明什么呢，说明你可以从摄像机看到这个点，并且光源也可以看到这个点。如果这个点在阴影里面，那就说明你看得到这个点，但是这个光看不到这个点。

### 经典阴影映射

经典的 shadow mapping 只能处理点光源/方向光，这种阴影通常有非常明显的边界。这个阴影的边界说明什么呢，要么这个点在阴影里，要么这一点就不在阴影里，就是一个非零即一的过程啊，这种阴影我们管它叫硬阴影。

1. 从光源看向这个场景（光源就像个摄像机）：从光源看向场景，记录你看到的任何点，它的深度是多少啊，即深度图。
2. 从相机看向这个场景：同样记录深度图
3. 将相机看到的深度图上的每一个点 A，映射回光源深度图对应的像素 P，计算这个点 A 到光源的深度，和像素 P记录的深度，如果 深度 A 大于 深度 P 说明这个点和光源之间有物体遮挡，如果 深度 A 等于 深度 P 说明这个点可以被光源看到

第一步：光源看到的深度图

![alt text](第一步：光源看到的深度图.png)

第二三步：摄像机看到的深度图和光源比对

![alt text](第二三步：摄像机看到的深度图和光源比对.png)

你会发现，按理说我们得到的是非零即一的结果，为什么还会有这种脏脏的点在呢？

1. 浮点数精度问题，导致我们判断深度相等时会有误差
2. 观察角度不同导致一个像素可能涵盖很多个点，具体如何取到点去重新映射到光源这件事情也是会有误差的。

可以用范围判断，引入可接受偏差，但是还是会导致各种各样的问题。

还有一个问题是，这两张深度图的精度问题，如果光深度分辨率很大，而渲染的图很小或者相反，都会造成不真实问题。

### 软阴影

光源有大小，具体从光源的哪里去生成深度图也是一个问题。

![alt text](软阴影.png)

越靠近物体根部接触的地方它越硬，然后越靠近这个就越远离物体这个根部越软。

完全看不到光源叫做本影（Umbra），部分看到光源是半影（Penumbra）

阴影程度取决于有多少或者说多大的光源你能够看

对于点光源确实是不可能出现软阴影的，就是说如果有软阴影，一定是因为光源有一定的大小好吧

## 阴影走样