- [1) 数学定义（3D 向量）](#1-数学定义3d-向量)
  - [常见性质](#常见性质)
- [2) 原理（方向与大小从何而来）](#2-原理方向与大小从何而来)
- [3) 几何意义](#3-几何意义)
  - [(1) 面积](#1-面积)
  - [(2) 朝向（有向面积）](#2-朝向有向面积)
  - [(3) 距离（点到直线）](#3-距离点到直线)
- [4) 图形学中的应用与原理](#4-图形学中的应用与原理)
  - [Orthonormal Coordinate Frames（正交归一坐标系）](#orthonormal-coordinate-frames正交归一坐标系)
    - [1) 三个单位向量（归一 / normal）](#1-三个单位向量归一--normal)
    - [2) 两两正交（orthogonal）](#2-两两正交orthogonal)
    - [3) 右手系与叉乘确定第三轴](#3-右手系与叉乘确定第三轴)
    - [4) 用投影把任意向量分解到这组基上（projection）](#4-用投影把任意向量分解到这组基上projection)
  - [2D 面上两个向量的左右位置关系](#2d-面上两个向量的左右位置关系)
  - [2D 面上，一个点是否在三角形内部](#2d-面上一个点是否在三角形内部)
  - [三角形面法线（光照/背面剔除/平面方程）](#三角形面法线光照背面剔除平面方程)
  - [顶点法线（平滑着色）](#顶点法线平滑着色)
  - [切线空间（Normal Mapping 的 TBN）](#切线空间normal-mapping-的-tbn)
  - [朝向/左右测试（有向面积判定）](#朝向左右测试有向面积判定)
  - [相机/物体坐标系构造（LookAt）](#相机物体坐标系构造lookat)
- [5) 常见坑（实现注意）](#5-常见坑实现注意)
- [思维路线图](#思维路线图)


叉乘定义了坐标系 

\[
\mathbf x\times \mathbf y= \mathbf z
\]

这个是我们默认的右手坐标系


判定左和右，判定内和外

# 1) 数学定义（3D 向量）

设 \( \mathbf a=(a_x,a_y,a_z) \)、\( \mathbf b=(b_x,b_y,b_z) \)，叉乘（向量积）定义为：

\[
\mathbf a\times \mathbf b=
\begin{pmatrix}
a_y b_z-a_z b_y\\
a_z b_x-a_x b_z\\
a_x b_y-a_y b_x
\end{pmatrix}
\]

等价地，用行列式记法：

\[
\mathbf a\times\mathbf b=
\begin{vmatrix}
\mathbf i & \mathbf j & \mathbf k\\
a_x & a_y & a_z\\
b_x & b_y & b_z
\end{vmatrix}
\]

## 常见性质

- **反交换**：\( \mathbf a\times\mathbf b=-(\mathbf b\times\mathbf a) \)
- **对加法分配**：\( \mathbf a\times(\mathbf b+\mathbf c)=\mathbf a\times\mathbf b+\mathbf a\times\mathbf c \)
- **与标量相容**：\( (\lambda \mathbf a)\times\mathbf b=\lambda(\mathbf a\times\mathbf b) \)
- **垂直性**：\( (\mathbf a\times\mathbf b)\cdot \mathbf a=0 \)，\( (\mathbf a\times\mathbf b)\cdot \mathbf b=0 \)
- **模长公式**：
  \[
  \|\mathbf a\times\mathbf b\|=\|\mathbf a\|\,\|\mathbf b\|\sin\theta
  \]
  其中 \( \theta\in[0,\pi] \) 为夹角。


不管怎么样，叉乘出来的都是向量，即使自己叉乘自己结果也是长度为 0 的向量。

\( (\mathbf a\times\mathbf a)\cdot \mathbf a=0 \)

---

# 2) 原理（方向与大小从何而来）

- **方向**：\( \mathbf a\times\mathbf b \) 同时垂直于 \( \mathbf a \) 与 \( \mathbf b \)，遵循**右手定则**（四指从 \( \mathbf a \) 卷向 \( \mathbf b \)，拇指方向即 \( \mathbf a\times\mathbf b \)）。
- **大小**：由 \( \sin\theta \) 决定：平行（\( \theta=0 \) 或 \( \pi \)）时为 0；垂直（\( \theta=\pi/2 \)）时最大。

---

# 3) 几何意义

## (1) 面积

\[
\text{Area(parallelogram)}=\|\mathbf a\times\mathbf b\|
\]
\[
\text{Area(triangle)}=\frac12\|\mathbf a\times\mathbf b\|
\]

## (2) 朝向（有向面积）

交换顺序会翻转法线方向：
\[
\mathbf a\times\mathbf b=-(\mathbf b\times\mathbf a)
\]
因此叉乘天然携带“顺/逆时针绕序”的信息。

## (3) 距离（点到直线）

点 \( \mathbf p \) 到直线（过点 \( \mathbf p_0 \)，方向 \( \mathbf d \)）的距离：
\[
\text{dist}=\frac{\|(\mathbf p-\mathbf p_0)\times \mathbf d\|}{\|\mathbf d\|}
\]
叉乘是以 \( \mathbf d \) 为底距离为高的平行四边形面积。

---

# 4) 图形学中的应用与原理

## Orthonormal Coordinate Frames（正交归一坐标系）  

**3D 的正交归一坐标系（Orthonormal Coordinate Frame / Orthonormal Basis）**：用三个两两垂直、长度为 1 的向量作为坐标轴，来表示任意向量。  

---  

### 1) 三个单位向量（归一 / normal）  

\[
\|\vec u\|=\|\vec v\|=\|\vec w\|=1
\]

含义：$\vec u,\vec v,\vec w$ 都是**单位向量**，长度为 1。  

### 2) 两两正交（orthogonal）  

\[
\vec u\cdot\vec v=\vec v\cdot\vec w=\vec u\cdot\vec w=0
\]

含义：任意两根轴互相垂直。  
原因：点乘 $\vec a\cdot\vec b=\|\vec a\|\|\vec b\|\cos\theta$。当点乘为 0 时 $\cos\theta=0\Rightarrow \theta=90^\circ$。  

### 3) 右手系与叉乘确定第三轴  

\[
\vec w=\vec u\times \vec v \quad(\text{right-handed})
\]

含义：用**右手定则**决定坐标系的“朝向/手性”（handedness）。  
如果 $\vec u,\vec v$ 是单位且正交，则 $\vec u\times\vec v$ 的长度也为 1，并且同时垂直于二者，所以它正好可以作为第三根轴 $\vec w$。  

> 备注：若取 $\vec w=\vec v\times\vec u$，得到的是相反方向（左手/翻转）。  

### 4) 用投影把任意向量分解到这组基上（projection）  

\[
\vec p=(\vec p\cdot\vec u)\vec u+(\vec p\cdot\vec v)\vec v+(\vec p\cdot\vec w)\vec w
\]

含义：在正交归一基下，$\vec p$ 在每根轴上的“坐标/分量”就是点乘：  
- $p_u=\vec p\cdot\vec u$  
- $p_v=\vec p\cdot\vec v$  
- $p_w=\vec p\cdot\vec w$  

因为 $\vec u,\vec v,\vec w$ 是单位正交基，点乘就直接给出**标量投影长度**，再乘回轴向量得到对应的分量向量，三者相加还原 $\vec p$。  

---

## 2D 面上两个向量的左右位置关系

\[
\mathbf a\times\mathbf b
\]

如果是正数，说明 b 在 a 左侧，反之 b 在 a 右侧。

## 2D 面上，一个点是否在三角形内部

a，b，c 三点，逆时针构成三角形，现有一点 p，如果 ab, bc， ca 分别和 ap, bp, cp 叉乘所得均为正，即 p 在三角形内部

其实就是 p 位于三个边的同一侧

这个在光栅化时有很大应用，我们要判断像素是否在三角形内部

## 三角形面法线（光照/背面剔除/平面方程）

三角形顶点 \( \mathbf v_0,\mathbf v_1,\mathbf v_2 \)，两条边：
\[
\mathbf e_1=\mathbf v_1-\mathbf v_0,\quad \mathbf e_2=\mathbf v_2-\mathbf v_0
\]
面法线（未归一化）：
\[
\mathbf n=\mathbf e_1\times \mathbf e_2
\]
归一化：
\[
\hat{\mathbf n}=\frac{\mathbf n}{\|\mathbf n\|}
\]

用途示例：
- Lambert 漫反射：\( \max(0,\hat{\mathbf n}\cdot \hat{\mathbf l}) \)
- 背面剔除：看 \( \hat{\mathbf n}\cdot \hat{\mathbf v} \) 的符号（依坐标系/绕序约定）
- 平面方程：\( \mathbf n\cdot(\mathbf x-\mathbf v_0)=0 \)

## 顶点法线（平滑着色）

把相邻面法线加权平均：
\[
\mathbf n_v=\sum_{f\in \text{adj}(v)} w_f\,\hat{\mathbf n}_f
\]
常见权重：
- 面积权重：直接累加未归一化 \( \mathbf e_1\times\mathbf e_2 \)（天然按面积加权）
- 角度权重：用顶点处夹角作为 \( w_f \)

## 切线空间（Normal Mapping 的 TBN）

法线贴图常需 \(T,B,N\) 正交基；常用
\[
\mathbf B \approx \operatorname{sign}\cdot (\mathbf N\times \mathbf T)
\]
保证正交与“右手性/左手性”。

## 朝向/左右测试（有向面积判定）

在 3D 中可用：
\[
\text{side} = ((\mathbf b-\mathbf a)\times(\mathbf p-\mathbf a))\cdot \mathbf n_{\text{ref}}
\]
符号决定点在有向边哪侧（\( \mathbf n_{\text{ref}} \) 为参考法线，如平面法线）。

在 2D 中常把点嵌入 \(z=0\)，叉乘的 \(z\) 分量就是有向面积，可用于绕序、点在三角形内等测试。

## 相机/物体坐标系构造（LookAt）

给定 forward \( \mathbf f \) 与世界 up \( \mathbf u \)，构造正交基：
\[
\mathbf r=\frac{\mathbf f\times \mathbf u}{\|\mathbf f\times \mathbf u\|},\quad
\mathbf u'=\mathbf r\times \mathbf f
\]

---

# 5) 常见坑（实现注意）

- **左手/右手坐标系差异**：会影响右手定则、绕序、背面剔除、法线方向，需统一约定。
- **顶点绕序（CW/CCW）**：绕序变化会让 \( \mathbf e_1\times\mathbf e_2 \) 法线翻转。
- **近平行数值问题**：当 \( \|\mathbf a\times\mathbf b\| \) 很小时归一化会放大误差；应做阈值处理或选替代 up 向量。

# 思维路线图

- 叉乘公式结果
- 行列式表达
- 正交归一坐标系表达
- 2D 两向量左右关系
- 2D 点在三角形内部还是外部